<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta htt-equiv='pragma' content='no-cache'>
    <meta http-equiv='cache-control' content='no-cache'>
    <title>Search Engine</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="sweetalert/sweetalert.css" rel="stylesheet">
</head>
<body style="width: 99%">
<div class="row" style="padding:100px 10px 10px; ">
    <div class="col-sm-2"></div>
    <div class=" form-group col-sm-7">
        <input type="text" class="form-control" name="search_input" id="search_input" onblur="changeInputFormat();"
               value="" placeholder="Search images" required/>
    </div>
    <div class="col-sm-2 m-l-n">
        <button type="button" class="btn btn-primary" id="search_button"
                onclick="searchImage();">
            <i class="fa fa-search"></i> Search
        </button>
    </div>
    <div class="col-sm-1"></div>
</div>
<div class="row" id="search_results" style="padding: 20px">
    <div class="col-lg-12">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <a data-toggle="collapse" data-parent="#accordion"
                   href="#search_results_panel" style="color: white"><h4 id="search_results_panel_heading">Results</h4>
                </a>
            </div>
            <div id="search_results_panel" class="ibox-content">
                <div class="row">
                    <div class="col-md-12" id="search_results_body" style="padding: 20px">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="jquery-2.1.1.js"></script>
<script src="bootstrap.min.js"></script>
<script src="sweetalert/sweetalert.min.js"></script>
<script src="call-ajax.js"></script>
<script src="HoldOn.min.js"></script>
<script>
    $(document).ready(function () {
        $('#search_results').hide();
    });

    function formHoldOn() {
        HoldOn.open({
            theme: "sk-cube-grid"
        });
    }

    function closeHoldOn() {
        HoldOn.close();
    }

    function displaySweetalert(title, text, type) {
        swal({
            title: title,
            text: text,
            type: type
        });

    }

    function searchImage() {
        var search_input = $('#search_input').val();
        var trimmed_input = search_input.replace(/&nbsp;|<\/?[^>]+(>|$)/g, "").trim();
        if (trimmed_input !== "") {
            formHoldOn();
            $('#search_results').hide();
            var url ="http://76e77f49.ngrok.io/query_images";
            var response = callAjax(url, {'query': search_input,'k':12}, 'GET');
            console.log(response);
            if (response[0]) {
                var image_list = response[1];
                // var image_list=[
                //     {
                //         "image":"https://www.w3schools.com/images/w3schools_green.jpg",
                //         "score":0.5
                //     },{
                //         "image":"https://www.gstatic.com/webp/gallery3/1.sm.png?dcb_=0.36774600550260095",
                //         "score":0.5
                //     },{
                //         "image":"https://www.gstatic.com/webp/gallery/4.sm.jpg?dcb_=0.42978000080540824",
                //         "score":0.5
                //     },{
                //         "image":"https://www.gstatic.com/webp/gallery3/2.sm.png",
                //         "score":0.5
                //     },{
                //         "image":"https://www.gstatic.com/webp/gallery3/3.sm.png",
                //         "score":0.5
                //     },{
                //         "image":"https://www.gstatic.com/webp/gallery3/4.sm.png",
                //         "score":0.5
                //     },{
                //         "image":"https://www.gstatic.com/webp/gallery3/5.sm.png",
                //         "score":0.5
                //     }
                // ];
                if (image_list.length === 0) {
                    displaySweetalert('Error', 'No image found!!!', 'error');
                } else {
                    displayImages(image_list, search_input);
                }
                closeHoldOn();
            } else {
                displaySweetalert('Error', response[1], 'error');
            }
        } else {
            displaySweetalert('Error', 'Kindly add some text to search images!!!', 'error');
        }

    }

    function changeInputFormat() {
        var text = $('#search_input').val();
        text = text.replace(/\s+/g, ' ');
        if (text.length > 0) {
            if (text[0] === " ") {
                text = text.replace(text[0], '');
            }
        }
        $('#search_input').val(text);
    }

    function displayImages(images, search_text) {
        var html = "";
        for (var i = 0; i < images.length; i++) {
            html += "<div class='col-sm-3' style='padding: 5px;'>" +
                "<img src='http://76e77f49.ngrok.io/serve_image?image="+images[i]['image']+"' alt='" + images[i]['image'] + "' width='250' height='250' title='Score: " + images[i]['score'] + "'>" +
                "</div>"
        }
        $('#search_results_body').html(html);
        $('#search_results_panel_heading').html(search_text.toUpperCase() + " RESULTS");
        $('#search_results').show();

    }
</script>
